BEGIN
	P_EJUD_MPM_PENDENTES(2024,9);
END;

DECLARE
    v_year NUMBER := 2018; -- Start year
    v_month NUMBER := 1;   -- Start month
BEGIN
    WHILE v_year < 2024 OR (v_year = 2024 AND v_month <= 7) LOOP
        -- Execute the procedure for the current year and month
        P_EJUD_MPM_PENDENTES(v_year, v_month);

        -- Increment the month
        v_month := v_month + 1;

        -- If the month exceeds 12, reset it to 1 and increment the year
        IF v_month > 12 THEN
            v_month := 1;
            v_year := v_year + 1;
        END IF;
    END LOOP;
END;

SELECT 
    ano, 
    mes, 
    COUNT(1) AS row_count
FROM 
    mpm_pendentes_hml
GROUP BY 
    ano, 
    mes
ORDER BY 
    ano DESC, 
    mes DESC;


SELECT *
FROM USER_ERRORS 
WHERE name = 'P_EJUD_MPM_PENDENTES' AND type = 'PROCEDURE';
	
SELECT * FROM (
WITH ejud_extracao AS (
    SELECT 
        NUM_PROCESSO,
        COD_CLASSE,
        COD_MAG,
        COD_ORG_JULG
    FROM MPM_PENDENTES_ANALITICO
    WHERE ANO = 2024 AND MES = 9
), 
jgd_extracao AS (
    SELECT 
        NUM_PROCESSO,
        COD_CLASSE,
        COD_MAG,
        COD_ORG_JULG,
        IND_COMPOSICAO
    FROM MPM_PENDENTES_HML
    WHERE ANO = 2024 AND MES = 9 AND IND_COMPOSICAO = 'Y'
)
SELECT 
    COALESCE(ejud_extracao.NUM_PROCESSO, jgd_extracao.NUM_PROCESSO) AS NUM_PROCESSO,
    ejud_extracao.COD_CLASSE AS ejud_cod_classe,
    jgd_extracao.cod_classe AS jgd_cod_classe,
    ejud_extracao.COD_ORG_JULG AS EJUD_OJ,
    jgd_extracao.COD_ORG_JULG AS JGD_OJ,
    ejud_extracao.COD_MAG AS EJUD_MAGISTRADO,
    jgd_extracao.COD_MAG AS JGD_MAGISTRADO,
    jgd_extracao.IND_COMPOSICAO,
    CASE 
        WHEN ejud_extracao.NUM_PROCESSO IS NOT NULL AND jgd_extracao.NUM_PROCESSO IS NOT NULL THEN 'AMBOS'
        WHEN ejud_extracao.NUM_PROCESSO IS NOT NULL THEN 'SISTEMA_EJUD'
        WHEN jgd_extracao.NUM_PROCESSO IS NOT NULL THEN 'EXTRACAO_JGD'
    END AS FLAG
FROM ejud_extracao
FULL OUTER JOIN jgd_extracao ON ejud_extracao.NUM_PROCESSO = jgd_extracao.NUM_PROCESSO)
WHERE FLAG IN ('EXTRACAO_JGD') ORDER BY NUM_PROCESSO DESC;

--processos APENAS an EXTRACAO em 2024/9
--1. 0951217-49.2023.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0951217-49.2023.8.19.0001'; 
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 26806641 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0951217-49.2023.8.19.0001';

--2. 0931363-69.2023.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0931363-69.2023.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27096743 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0931363-69.2023.8.19.0001';

--3. 0893069-45.2023.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0893069-45.2023.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 26592829 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0893069-45.2023.8.19.0001';

--4. 0883889-05.2023.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0883889-05.2023.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27134214 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0883889-05.2023.8.19.0001';

--5. 0877142-73.2022.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0877142-73.2022.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27066314 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0877142-73.2022.8.19.0001';

--6. 0876181-64.2024.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0876181-64.2024.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27576166 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0876181-64.2024.8.19.0001';

--7. 0869511-78.2022.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0869511-78.2022.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27030197 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0869511-78.2022.8.19.0001';

--8. 0865708-87.2022.8.19.0001
SELECT * FROM EJUD_FAC_PROCESSO WHERE NUM_PROCESSO = '0865708-87.2022.8.19.0001';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 27338224 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '0865708-87.2022.8.19.0001';


--processos APENAS an EXTRACAO em 2018/1
--1. 2238577-78.2011.8.19.0021
SELECT * FROM MPM_PENDENTES_HML WHERE NUM_PROCESSO = '2238577-78.2011.8.19.0021';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 12844707 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '2238577-78.2011.8.19.0021';

--2. 2238006-10.2011.8.19.0021
SELECT * FROM MPM_PENDENTES_HML WHERE NUM_PROCESSO = '2238006-10.2011.8.19.0021';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 13213301 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '2238006-10.2011.8.19.0021';

--3. 2237393-87.2011.8.19.0021
SELECT * FROM MPM_PENDENTES_HML WHERE NUM_PROCESSO = '2238006-10.2011.8.19.0021';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 13213301 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '2238006-10.2011.8.19.0021';

--4. 2237168-67.2011.8.19.0021
SELECT * FROM MPM_PENDENTES_HML WHERE NUM_PROCESSO = '2237168-67.2011.8.19.0021';
SELECT * FROM EJUD_MPM_BASEDEDADOS WHERE CODDOC = 13663789 ORDER BY DTHRMOV DESC;
SELECT * FROM MPM_PENDENTES_ANALITICO WHERE NUM_PROCESSO = '2237168-67.2011.8.19.0021';

SELECT * FROM ejud.historicomagistradocomposicao@tj01;

--5. 2234506-33.2011.8.19.0021
--6. 2233971-07.2011.8.19.0021
--7. 2227030-41.2011.8.19.0021
--8. 2221716-17.2011.8.19.0021
--9. 2219986-68.2011.8.19.0021
--10. 2213604-59.2011.8.19.0021
